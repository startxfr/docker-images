##
## STAGES
##

# Build the fedora image
build-os:
  stage: "build OS"
  extends: .build-image
  variables:
    SXDI_PATH: 'OS'
<<<<<<< HEAD
    SXDI_DOCKERNAME: 'alpine'
    SXDI_QUAYNAME: 'alpine'
=======
    SXDI_DOCKERNAME: ${SXDI_OSNAME}
    SXDI_QUAYNAME: ${SXDI_OSNAME}
>>>>>>> master
    SXDI_TAG: ${SXDI_OSTAG}

# Build the latest of images other than fedora (master)
build-os-latest:
  stage: "build OS"
  extends: .build-image
  variables:
    SXDI_PATH: 'OS'
<<<<<<< HEAD
    SXDI_DOCKERNAME: 'alpine'
    SXDI_QUAYNAME: 'alpine'
=======
    SXDI_DOCKERNAME: ${SXDI_OSNAME}
    SXDI_QUAYNAME: ${SXDI_OSNAME}
>>>>>>> master
    SXDI_TAG: latest
  only:
    - centos8
    - alpine
    - ubi8

include:
  - template: Security/Container-Scanning.gitlab-ci.yml

# Scanning of the containers
container_scanning:
  stage: "build OS"
  variables:
    GIT_STRATEGY: fetch
    DOCKER_IMAGE: quay.io/startx/${SXDI_OSNAME}:${SXDI_OSTAG}"